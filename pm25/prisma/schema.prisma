generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =========================
// ENUM / MODEL เดิม
// =========================

enum Role {
  administrator
  superadmin
  admin
  region
  province
  unit
}

model admin {
  id       Int    @id @default(autoincrement())
  username String @unique
  password String
  role     Role

  pname String?
  fname String
  lname String

  hospcode   String? // FK -> hospcode.hospcode
  position   String?
  positionLv String?
  tel        String?
  email      String? @unique

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt       @map("updated_at")

  hosp hospcode? @relation(fields: [hospcode], references: [hospcode])

  @@index([hospcode])
  @@map("admin")
}

model hospcode {
  hospcode           String  @id
  hospcode_old       String?
  name_th            String?
  type               String?
  type_organizations String?
  organizations      String?
  county             String?
  province_id        String?
  province           String?
  amphure_id         String?
  amphure            String?
  districts_id       String?
  districts          String?

  admins admin[]

  @@index([province])
  @@index([amphure])
  @@index([districts])
  @@map("hospcode")
}

// =========================
// 1) ตารางประชากรกลางปี
// =========================

model midyear_population {
  id           Int    @id @default(autoincrement())
  provinceCode String @map("province_code")
  provinceName String @map("province_name")
  population   Int

  @@index([provinceCode])
  @@map("midyear_population")
}

// =========================
// 2) ตารางฝุ่นรายวัน (สรุปแบบ max/min/avg เท่านั้น)
// =========================

model pm25_hourly {
  id            Int       @id @default(autoincrement())
  stationId     String?   @map("station_id")
  stationIdNew  String?   @map("station_id_new")
  stationName   String?   @map("station_name")
  stationType   String?   @map("station_type")
  latitude      Float?
  longitude     Float?
  province      String?
  district      String?
  subdistrict   String?

  // วัน+เวลา ในคอลัมน์เดียว และต้องเป็น timestamptz
  air4Time      DateTime  @db.Timestamptz(3) @map("air4_time")

  pm25 Float?
  pm10 Float?
  o3   Float?
  co   Float?
  no2  Float?
  so2  Float?

  @@unique([stationIdNew, air4Time])
  @@index([stationIdNew])
  @@index([air4Time])
  @@map("pm25_hourly")
}

model pm25_daily {
  id          Int      @id @default(autoincrement())
  air4Date    DateTime @db.Date @map("air4_date")

  stationId     String? @map("station_id")
  stationIdNew  String? @map("station_id_new")
  stationName   String? @map("station_name")
  stationType   String? @map("station_type")
  latitude      Float?
  longitude     Float?
  province      String?
  district      String?
  subdistrict   String?

  // ===== Max / Min / Avg ของทุกตัวมลพิษ =====
  pm25_max Float?
  pm25_min Float?
  pm25_avg Float?

  pm10_max Float?
  pm10_min Float?
  pm10_avg Float?

  o3_max  Float?
  o3_min  Float?
  o3_avg  Float?

  co_max  Float?
  co_min  Float?
  co_avg  Float?

  no2_max Float?
  no2_min Float?
  no2_avg Float?

  so2_max Float?
  so2_min Float?
  so2_avg Float?

  @@unique([stationIdNew, air4Date])
  @@index([stationIdNew])
  @@index([air4Date])
  @@map("pm25_daily")
}



// =========================
// 3) ตารางผู้ป่วยรายสัปดาห์ (disease)
// =========================

model disease_weekly {
  id           Int       @id @default(autoincrement())
  provinceId   String?   @map("province_id")
  provinceName String?   @map("province_name")
  typeDiag     String?   @map("type_diag") // Typediag (OPD/IPD/ALL)
  cases        Int
  year         Int
  week         Int?
  month        Int?
  createDate   DateTime? @default(now()) @map("create_date")

  @@index([year])
  @@index([provinceId])
  @@map("disease_weekly")
}

// =========================
// 4) ค่าฝุ่นติดสะสม threshold 37
// =========================

model pm25_cumulative37 {
  id                      Int      @id @default(autoincrement())
  date                    DateTime @db.Date
  province                String
  pm25                    Float?
  aboveThreshold          Boolean  @map("above_threshold")
  consecutiveDays         Int      @map("consecutive_days")
  consecutiveAboveMinDays Int      @map("consecutive_above_min_days")
  regionalHealth          String?  @map("regional_health")

  @@index([date])
  @@index([province])
  @@map("pm25_cumulative37")
}

// =========================
// 5) ค่าฝุ่นติดสะสม threshold 75
// =========================

model pm25_cumulative75 {
  id                      Int      @id @default(autoincrement())
  date                    DateTime @db.Date
  province                String
  pm25                    Float?
  aboveThreshold          Boolean  @map("above_threshold")
  consecutiveDays         Int      @map("consecutive_days")
  consecutiveAboveMinDays Int      @map("consecutive_above_min_days")
  regionalHealth          String?  @map("regional_health")

  @@index([date])
  @@index([province])
  @@map("pm25_cumulative75")
}

// =========================
// 6) ตาราง patients
// =========================

model patients {
  id Int @id @default(autoincrement())

  dateServ     DateTime  @map("date_serv") @db.Date
  odpc         String?
  changwatname String?
  ampurname    String?
  tambonname   String?

  hospcode String?
  hosname  String?

  sex        String?
  birth      DateTime? @db.Date
  age        Int?
  nation     String?
  occupation String?
  typearea   String?

  diagcode String?
  diagtype String?
  diagname String?
  typediag String?

  createDate DateTime? @map("create_date")

  @@index([dateServ])
  @@index([hospcode])
  @@map("patients")
}

// =========================
 // 7) ตารางสถานีตรวจวัดอากาศ (อิสระจาก hourly/daily)
// =========================

model stations {
  id             Int     @id @default(autoincrement())
  station_id     String?
  station_id_new String?
  station_name   String?
  station_type   String?
  latitude       Float?
  longitude      Float?
  province       String?
  district       String?
  subdistrict    String?

  @@index([station_id])
  @@index([station_id_new])
  @@index([province])
  @@map("stations")
}
